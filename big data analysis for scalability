# Remove null values
df_clean = df.dropna()

# Add total_sales column
from pyspark.sql.functions import col

df_clean = df_clean.withColumn(
    "total_sales",
    col("quantity") * col("price")
)

df_clean.show(5)
from pyspark.sql.functions import sum

df_clean.select(sum("total_sales").alias("Total Revenue")).show()
df_clean.groupBy("category") \
    .sum("total_sales") \
    .orderBy("sum(total_sales)", ascending=False) \
    .show()
df_clean.groupBy("product") \
    .sum("quantity") \
    .orderBy("sum(quantity)", ascending=False) \
    .show(5)
df_clean.groupBy("region") \
    .sum("total_sales") \
    .orderBy("sum(total_sales)", ascending=False) \
    .show()
from pyspark.sql.functions import month

df_monthly = df_clean.withColumn("month", month("order_date"))

df_monthly.groupBy("month") \
    .sum("total_sales") \
    .orderBy("month") \
    .show()
